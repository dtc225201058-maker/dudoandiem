<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Sinh Vi√™n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            border-bottom: 1px solid #ccc;
            background: white;
        }
        .header-right {
            display: flex;
            gap: 10px;
        }
        .header span {
            font-size: 16px;
            margin-right: 15px;
        }
        button {
            background: #d9534f;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background: #c9302c;
        }
        .container {
            max-width: 750px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .btn-submit {
            background: #28a745;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        .btn-submit:hover {
            background: #218838;
        }
        #result {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            color: #007bff;
        }
    </style>
</head>
<body>
    <!-- Thanh header -->
    <div class="header">
        <span>Xin ch√†o, <span id="studentId"></span></span>
        <div class="header-right">
            <button type="button" onclick="window.location.href='history.html'">
                üìú L·ªãch s·ª≠
            </button>
            <button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- N·ªôi dung ch√≠nh -->
    <div class="container">
        <h2>üéØ D·ª± ƒëo√°n ƒëi·ªÉm cu·ªëi k·ª≥</h2>

        <div class="form-row">
            <div class="form-group">
                <label>M√¥n h·ªçc</label>
                <select id="monHoc">
                    <option value="Tri·∫øt h·ªçc M√°c ‚Äì L√™nin">Tri·∫øt h·ªçc M√°c ‚Äì L√™nin</option>
                    <option value="Kinh t·∫ø ch√≠nh tr·ªã M√°c ‚Äì L√™nin">Kinh t·∫ø ch√≠nh tr·ªã M√°c ‚Äì L√™nin</option>
                    <option value="Ch·ªß nghƒ©a x√£ h·ªôi khoa h·ªçc">Ch·ªß nghƒ©a x√£ h·ªôi khoa h·ªçc</option>
                    <option value="T∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh">T∆∞ t∆∞·ªüng H·ªì Ch√≠ Minh</option>
                    <option value="ƒê∆∞·ªùng l·ªëi c√°ch m·∫°ng c·ªßa ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam">ƒê∆∞·ªùng l·ªëi c√°ch m·∫°ng c·ªßa ƒê·∫£ng C·ªông s·∫£n Vi·ªát Nam</option>
                    <option value="Nh·∫≠p m√¥n CNTT">Nh·∫≠p m√¥n CNTT</option>
                    <option value="K·ªπ thu·∫≠t l·∫≠p tr√¨nh">K·ªπ thu·∫≠t l·∫≠p tr√¨nh</option>
                    <option value="C·∫•u tr√∫c d·ªØ li·ªáu v√† gi·∫£i thu·∫≠t">C·∫•u tr√∫c d·ªØ li·ªáu v√† gi·∫£i thu·∫≠t</option>
                    <option value="To√°n cao c·∫•p A1">To√°n cao c·∫•p A1</option>
                    <option value="To√°n cao c·∫•p A2">To√°n cao c·∫•p A2</option>
                    <option value="X√°c su·∫•t th·ªëng k√™">X√°c su·∫•t th·ªëng k√™</option>
                    <option value="ƒê·∫°i s·ªë tuy·∫øn t√≠nh">ƒê·∫°i s·ªë tuy·∫øn t√≠nh</option>
                    <option value="H·ªá ƒëi·ªÅu h√†nh">H·ªá ƒëi·ªÅu h√†nh</option>
                    <option value="Ki·∫øn tr√∫c m√°y t√≠nh">Ki·∫øn tr√∫c m√°y t√≠nh</option>
                    <option value="Ng√¥n ng·ªØ l·∫≠p tr√¨nh Java">Ng√¥n ng·ªØ l·∫≠p tr√¨nh Java</option>
                    <option value="C∆° s·ªü d·ªØ li·ªáu">C∆° s·ªü d·ªØ li·ªáu</option>
                    <option value="M·∫°ng m√°y t√≠nh">M·∫°ng m√°y t√≠nh</option>
                    <option value="L·∫≠p tr√¨nh Web">L·∫≠p tr√¨nh Web</option>
                    <option value="Ph√¢n t√≠ch v√† thi·∫øt k·∫ø h·ªá th·ªëng th√¥ng tin">Ph√¢n t√≠ch v√† thi·∫øt k·∫ø h·ªá th·ªëng th√¥ng tin</option>
                    <option value="C√¥ng ngh·ªá ph·∫ßn m·ªÅm">C√¥ng ngh·ªá ph·∫ßn m·ªÅm</option>
                    <option value="L·∫≠p tr√¨nh Python">L·∫≠p tr√¨nh Python</option>
                    <option value="L·∫≠p tr√¨nh .NET">L·∫≠p tr√¨nh .NET</option>
                    <option value="H·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu">H·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu</option>
                    <option value="Tr√≠ tu·ªá nh√¢n t·∫°o">Tr√≠ tu·ªá nh√¢n t·∫°o</option>
                    <option value="L·∫≠p tr√¨nh di ƒë·ªông">L·∫≠p tr√¨nh di ƒë·ªông</option>
                    <option value="Th·ª±c t·∫≠p doanh nghi·ªáp">Th·ª±c t·∫≠p doanh nghi·ªáp</option>
                    <option value="Kh√≥a lu·∫≠n t·ªët nghi·ªáp">Kh√≥a lu·∫≠n t·ªët nghi·ªáp</option>
                </select>
            </div>

            <div class="form-group">
                <label>ƒêi·ªÉm ƒë·∫ßu gi·ªù (0-10)</label>
                <input type="number" id="diemDauGio" min="0" max="10">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>ƒêi·ªÉm k·ªπ nƒÉng (0-10)</label>
                <input type="number" id="diemKyNang" min="0" max="10">
            </div>
            <div class="form-group">
                <label>S·ªë bu·ªïi ƒëi h·ªçc</label>
                <select id="soBuoiHoc">
                    <option value="10">ƒê·ªß</option>
                    <option value="8">V·∫Øng 1</option>
                    <option value="6">V·∫Øng 2</option>
                    <option value="4">V·∫Øng 3</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>M·ª©c ƒë·ªô t·∫≠p trung</label>
                <select id="tapTrung">
                    <option value="2">0-20%</option>
                    <option value="4">21-40%</option>
                    <option value="6">41-60%</option>
                    <option value="8">61-80%</option>
                    <option value="10">81-100%</option>
                </select>
            </div>
            <div class="form-group">
                <label>M·ª©c ƒë·ªô ti·∫øp nh·∫≠n ki·∫øn th·ª©c</label>
                <select id="tiepNhan">
                    <option value="2">0-20%</option>
                    <option value="4">21-40%</option>
                    <option value="6">41-60%</option>
                    <option value="8">61-80%</option>
                    <option value="10">81-100%</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>M·ª©c ƒë·ªô t·ª± h·ªçc</label>
                <select id="tuHoc">
                    <option value="4">&lt;1h</option>
                    <option value="7">&lt;3h</option>
                    <option value="10">&gt;3h</option>
                </select>
            </div>
        </div>

        <button class="btn-submit" onclick="duDoan()">D·ª± ƒëo√°n</button>
        <div id="result"></div>
    </div>

<script>
  // ====== L·∫§Y student_id t·ª´ localStorage ho·∫∑c URL ======
  let studentId = localStorage.getItem('student_id');

  // N·∫øu localStorage kh√¥ng c√≥ th√¨ th·ª≠ l·∫•y t·ª´ URL (?id=...)
  if (!studentId) {
    const params = new URLSearchParams(window.location.search);
    studentId = params.get("id");

    if (studentId) {
      // ‚úÖ L∆∞u l·∫°i v√†o localStorage ƒë·ªÉ d√πng cho l·∫ßn sau
      localStorage.setItem("student_id", studentId);
    }
  }

  // N·∫øu v·∫´n kh√¥ng c√≥ studentId => bu·ªôc quay v·ªÅ trang ƒëƒÉng nh·∫≠p
  if (!studentId) {
    alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p, vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!");
    window.location.href = 'index.html';
  } else {
    // ‚úÖ Hi·ªÉn th·ªã t√™n sinh vi√™n
    document.getElementById('studentId').textContent = studentId;

    // ‚úÖ G·ªçi h√†m load l·ªãch s·ª≠ ngay sau khi c√≥ studentId
    loadHistory();
  }

  // ====== N√öT ƒêƒÇNG XU·∫§T ======
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('student_id');
    window.location.href = 'index.html';
  });

  // ====== H√ÄM D·ª∞ ƒêO√ÅN V√Ä G·ª¨I L√äN SERVER ======
  function duDoan() {
    const subject = document.getElementById('monHoc').value;
    const dg = clamp(parseFloat(document.getElementById('diemDauGio').value));
    const kn = clamp(parseFloat(document.getElementById('diemKyNang').value));
    const buoi = parseFloat(document.getElementById('soBuoiHoc').value);
    const focus = parseFloat(document.getElementById('tapTrung').value);
    const know = parseFloat(document.getElementById('tiepNhan').value);
    const self = parseFloat(document.getElementById('tuHoc').value);

    const score = ((dg + kn + buoi + focus + know + self) / 6).toFixed(2);

    document.getElementById('result').textContent =
      `üéØ D·ª± ƒëo√°n ƒëi·ªÉm cu·ªëi k·ª≥: ${score}`;

    // ‚úÖ G·ª≠i d·ªØ li·ªáu d·ª± ƒëo√°n l√™n server
    fetch('https://dudoandiem-1.onrender.com/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        student_id: studentId,
        subject,
        score
      })
    })
    .then(res => res.json())
    .then(data => {
      console.log('‚úÖ L∆∞u d·ª± ƒëo√°n th√†nh c√¥ng:', data);
      // üî• Sau khi l∆∞u th√†nh c√¥ng, load l·∫°i l·ªãch s·ª≠
      loadHistory();
    })
    .catch(err => console.error('‚ùå L·ªói khi l∆∞u d·ª± ƒëo√°n:', err));
  }

  // ====== H√ÄM L·∫§Y L·ªäCH S·ª¨ D·ª∞ ƒêO√ÅN ======
  function loadHistory() {
    fetch(`https://dudoandiem-1.onrender.com/history/${studentId}`)
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById('historyTable');
        table.innerHTML = ""; // Xo√° c≈©

        if (!data || data.length === 0) {
          table.innerHTML = "<tr><td colspan='3'>Ch∆∞a c√≥ l·ªãch s·ª≠ d·ª± ƒëo√°n</td></tr>";
          return;
        }

        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.subject}</td>
            <td>${row.score}</td>
            <td>${new Date(row.created_at).toLocaleString('vi-VN')}</td>
          `;
          table.appendChild(tr);
        });
      })
      .catch(err => {
        console.error('‚ùå L·ªói khi t·∫£i l·ªãch s·ª≠:', err);
        document.getElementById('historyTable').innerHTML =
          "<tr><td colspan='3'>L·ªói khi t·∫£i l·ªãch s·ª≠</td></tr>";
      });
  }

  // ====== H√ÄM CH·∫∂N GI√Å TR·ªä NH·∫¨P NGO√ÄI 0‚Äì10 ======
  function clamp(x, lo = 0, hi = 10) {
    if (isNaN(x)) return 0;
    return Math.max(lo, Math.min(hi, x));
  }
</script>



</body>
</html>
